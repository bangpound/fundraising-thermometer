<?xml version="1.0" encoding="UTF-8" ?>
<Module>
    <ModulePrefs title="Fundraising Thermometer">
        <Require feature="dynamic-height"/>
    </ModulePrefs>
    <UserPref name="fundingGoal" display_name="Goal" required="true" />
    <UserPref name="currentFunds" display_name="Current Funds" default_value="0" required="true"/>
    <UserPref name="orientation" display_name="Orientation" datatype="enum" default_value="bvs">
        <EnumValue value="vertical" display_value="Vertical"/>
        <EnumValue value="horizontal" display_value="Horizontal"/>
    </UserPref>
    <UserPref name="goalColor" display_name="Goal bar color" default_value="592E76" required="true"/>
    <UserPref name="currentColor" display_name="Current funds bar color" default_value="BFBC8F" required="true"/>
    <UserPref name="chartSize" display_name="Size" default_value="450" required="true"/>
    <UserPref name="barWidth" display_name="Chart bar width" default_value="45" required="true"/>
    <Content type="html">
        <![CDATA[

            <script>
            //	load prefs
            var prefs = new gadgets.Prefs();

            //  register startup function
            gadgets.util.registerOnLoadHandler(makeGraph); 

                function genGraphURL(goal, currentValue, backgroundColor, foregroundColor, orientation, size, barWidth){
                    
                    //  base chart string
                    var chartString = "http://chart.apis.google.com/chart?cht=";// + prefs.getString("orientation");
                    
                    //  orientation
                    if(orientation === "vertical"){
                        //  use the vertical chart
                        chartString = chartString + "bvs&chxt=y";
                        
                        //  size the vertical axis
                        chartString = chartString + "&chs=" + "100x" + size;
                        
                        //  also adjust gadget height
                        gadgets.window.adjustHeight();
                        
                    } else {
                    
                        chartString = chartString + "bhs&chxt=x";
                        
                        //  size the horizontal axis                        
                        chartString = chartString + "&chs=" + size + "x100";
                        
                        //  also adjust gadget height
                        gadgets.window.adjustHeight();
                    }
                    
                    //  add size
                    //chartString = chartString + "&chs=" + height + "x" + width;

                    //  add colors
                    chartString = chartString + "&chco=" + backgroundColor + "," + foregroundColor;

                    //  setup range
                    chartString = chartString + "&chd=t:" + currentValue + "|" + goal;
                    chartString = chartString + "&chm=N$,000000,0,-1,11";
                    chartString = chartString + "&chxr=0,0," + goal + "," + goal/10;

                    //  set bar width
                    chartString = chartString + "&chbh=" + barWidth;
                    
                    //  set scaling
                    chartString = chartString + "&chds=0," + goal;             
                    
                    return chartString;
                }

                function makeGraph(){
                    
                    //  get the id of the chart image holder
                    var chartImage = document.getElementById("chart");

                    var goal = prefs.getString("fundingGoal"); //document.getElementById("goal").value;
                    var current = prefs.getString("currentFunds"); //document.getElementById("current").value;
                    var bcolor = prefs.getString("goalColor");//"592E76"; //document.getElementById("bcolor").value;
                    var fcolor = prefs.getString("currentColor");//"BFBC8F"; //document.getElementById("fcolor").value;
                    var orientation = prefs.getString("orientation");
                    var size = prefs.getString("chartSize");
                    var barWidth = prefs.getString("barWidth");

                    var url = genGraphURL(goal, current, bcolor, fcolor, orientation, size, barWidth);
                    
                    //var chartURLBox = document.getElementById("charturl");
                    //chartURLBox.value = url;

                    //  set the source property
                    chartImage.src = url;
                }
           </script>
            <img id="chart"/>
        ]]>
    </Content>
</Module>